<script>
  const form = document.getElementById('expense-form');
  form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const category = document.getElementById('category').value;
    const items = document.getElementById('item').value.split(',').map(i => i.trim());
    const brand = document.getElementById('brand').value;
    const costs = document.getElementById('cost').value.split(',').map(c => c.trim());
    const quantities = document.getElementById('quantity').value.split(',').map(q => q.trim());
    const oil = document.getElementById('oil').value;
    const oilBrand = document.getElementById('oilBrand').value;
    const oilCost = document.getElementById('oilCost').value;
    const oilQty = document.getElementById('oilQty').value;
    const date = document.getElementById('date').value;

    let successCount = 0;

    for (let i = 0; i < items.length; i++) {
      const expenseData = {
        Category: category,
        Item: items[i] || '',
        Brand: brand,
        Cost: costs[i] || '',
        Quantity: quantities[i] || '',
        OilType: oil,
        OilBrand: oilBrand,
        OilCost: oilCost,
        OilQty: oilQty,
        Date: date
      };

      try {
        const response = await fetch('https://script.google.com/macros/s/AKfycbyDNqngYUIPSYBn4cKMm3xMsew1I8xuYwbe6NbKJNa-BCs5MQsKFmSJWMawZOY-INEs2g/exec', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(expenseData)
        });

        const result = await response.json();

        if (result.status === "success") {
          successCount++;
        } else {
          console.error("Backend error:", result.message || result);
        }

      } catch (err) {
        console.error("Fetch/network error:", err);
      }
    }

    if (successCount > 0) {
      alert(`${successCount} expense(s) added successfully!`);
      form.reset();
    } else {
      alert("No expenses were saved. Check your internet or backend.");
    }
  });
</script>
